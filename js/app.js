// Generated by CoffeeScript 1.6.2
(function() {
  var App,
    __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  App = (function() {
    var DEV_MIXPANEL_TOKEN, LOCATION_URL, PROD_MIXPANEL_TOKEN, PROD_ROOT_DOMAIN;

    LOCATION_URL = 'http://54.85.163.238';

    PROD_ROOT_DOMAIN = "fravic.com";

    DEV_MIXPANEL_TOKEN = "3e0e6b7523b1b89c23e3f916353b4e29";

    PROD_MIXPANEL_TOKEN = "7625405302264f41acc4ae05b9861ff7";

    function App() {
      this.onResize = __bind(this.onResize, this);
      this.loadMapLocation = __bind(this.loadMapLocation, this);
      this.setupMap = __bind(this.setupMap, this);
      this.render = __bind(this.render, this);      this.map = null;
    }

    App.prototype.render = function() {
      try {
        Typekit.load();
      } catch (_error) {}
      document.addEventListener("touchstart", function() {
        return null;
      }, true);
      this.setupMap();
      this.loadMapLocation();
      $(window).on("resize", this.onResize);
      this.onResize();
      this.initAnalytics();
      return mixpanel.track("index:view");
    };

    App.prototype.initAnalytics = function() {
      var hostname;

      hostname = new URL(window.location).hostname;
      if (hostname.indexOf("www.") === 0) {
        hostname = hostname.slice("www.".length);
      }
      return mixpanel.init(hostname === PROD_ROOT_DOMAIN ? PROD_MIXPANEL_TOKEN : DEV_MIXPANEL_TOKEN);
    };

    App.prototype.renderMapMarker = function(name, createdAt) {
      $(".venue-name").html(name);
      $(".created-at").html("Updated " + (moment(createdAt * 1000).fromNow()));
      $(".marker").show();
      $(".created-at").show();
      return $(".label-container").css({
        marginLeft: (-$(".label-container").outerWidth() / 2) + "px"
      });
    };

    App.prototype.setupMap = function() {
      this.map = L.mapbox.map('map', 'fravic.j11ifpci', {
        attributionControl: false,
        zoomControl: false
      });
      this.map.dragging.disable();
      this.map.touchZoom.disable();
      this.map.doubleClickZoom.disable();
      return this.map.scrollWheelZoom.disable();
    };

    App.prototype.loadMapLocation = function() {
      var _this = this;

      return $.getJSON(LOCATION_URL, function(res) {
        if (res.apiError) {
          console.log("API Error:", res.apiError);
          return;
        }
        _this.map.setView([res.lat, res.lng], 13);
        return _this.renderMapMarker(res.name, res.createdAt);
      }).error(function() {
        return console.log("Server Error: Could not load map location");
      });
    };

    App.prototype.onResize = function() {};

    App.prototype.isMobile = function() {
      return /Android|iPhone|iPad|iPod|BlackBerry|Windows Phone/i.test(navigator.userAgent || navigator.vendor || window.opera);
    };

    return App;

  })();

  window.app = new App();

  $(app.render);

}).call(this);
